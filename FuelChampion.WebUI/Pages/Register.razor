@inject ApiService ApiService
@inject NavigationManager NavigationManager
@page "/Rejestracja"

<PageTitle>Rejestracja</PageTitle>

<div class="row">
    <div class="col-lg-4 offset-lg-4 pt-4 pb-4  border">
        <EditForm Model="User" OnValidSubmit="HandleSubmit" FormName="RegisterForm">
            <h3>Rejestracja</h3>
            <DataAnnotationsValidator />
            <div class="mb-3">
                <label for="userName">Nazwa użytkownika:</label>
                <InputText id="userName" @bind-Value="User.UserName" class="form-control" />
            </div>
            <div class="mb-3">
                <label for="email">E-mail:</label>
                <InputText id="email" @bind-Value="User.Email" class="form-control" />
            </div>
            <div class="mb-3">
                <label for="password">Hasło:</label>
                <InputText type="password" id="password" @bind-Value="User.Password" class="form-control" />
            </div>
            <div class="mb-3">
                <label for="voivodeship">Województwo</label>
                <InputSelect id="voivodeship" @bind-Value="User.Voivodeship" class="form-control" DisplayName="Wybierz województwo">
                    <option value=""></option>
                    @foreach (var voievodeship in EnumExtensions.ToList<Voivodeship>())
                    {
                        <option value="@voievodeship.Value">@voievodeship.Description</option>
                    }
                </InputSelect>
            </div>
            <div class="mb-3">
                <label for="city">Miasto</label>
                <InputText id="city" @bind-Value="User.City" class="form-control" />
            </div>
            <div class="mb-3 text-center">
                <span class="text-danger">@errorMessage</span>
            </div>
            <button type="submit" class="mt-3 btn btn-primary">Zarejestruj</button>
            <ValidationSummary class="mt-3 text-danger"></ValidationSummary>
        </EditForm>
    </div>
</div>

@code {
    private string? errorMessage { get; set; }
    public int? Id { get; set; }
    public RegisterDto User = new RegisterDto();

    async Task HandleSubmit()
    {
        HttpContent httpContent = JsonContent.Create(User);
        await ApiService.PostAsync<User>("/UserRegister", httpContent).ContinueWith(x =>
        {
            if (x.Result.IsSuccessStatusCode)
            {
                NavigationManager.NavigateTo("/history");
            }
            else
            {
                // todo: komunikaty
            }
        });
    }

}
